# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/power/rockchip,power-controller.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Rockchip Power Domains

maintainers:
  - Caesar Wang <wxt@rock-chips.com>
  - Heiko Stuebner <heiko@sntech.de>

description: |
  Rockchip processors include support for multiple power domains which can be
  powered up/down by software based on different application scenes to save power.

  Power domains contained within power-controller node are generic power domain
  providers documented in Documentation/devicetree/bindings/power/power-domain.yaml.

  IP cores belonging to a power domain should contain a 'power-domains'
  property that is a phandle for the power domain node representing the domain.

properties:
  power-controller:
    type: object
    description: List of power domains provided by this controller.

    properties:
      compatible:
        enum:
          - rockchip,px30-power-controller
          - rockchip,rk3036-power-controller
          - rockchip,rk3066-power-controller
          - rockchip,rk3128-power-controller
          - rockchip,rk3188-power-controller
          - rockchip,rk3228-power-controller
          - rockchip,rk3288-power-controller
          - rockchip,rk3328-power-controller
          - rockchip,rk3366-power-controller
          - rockchip,rk3368-power-controller
          - rockchip,rk3399-power-controller

      reg:
        description: |
          Power domain index. Valid values are defined in:
          "include/dt-bindings/power/px30-power.h" - for PX30 type power domain.
          "include/dt-bindings/power/rk3036-power.h" - for RK3036 type power domain.
          "include/dt-bindings/power/rk3066-power.h" - for RK3066 type power domain.
          "include/dt-bindings/power/rk3128-power.h" - for RK3128 type power domain.
          "include/dt-bindings/power/rk3188-power.h" - for RK3188 type power domain.
          "include/dt-bindings/power/rk3228-power.h" - for RK3228 type power domain.
          "include/dt-bindings/power/rk3288-power.h" - for RK3288 type power domain.
          "include/dt-bindings/power/rk3328-power.h" - for RK3328 type power domain.
          "include/dt-bindings/power/rk3366-power.h" - for RK3366 type power domain.
          "include/dt-bindings/power/rk3368-power.h" - for RK3368 type power domain.
          "include/dt-bindings/power/rk3399-power.h" - for RK3399 type power domain.
        maxItems: 1

      clocks:
        description: |
          A number of phandles to clocks that need to be enabled while power domain
          switches state.
      pm_qos:
        description: |
          A number of phandles to qos blocks which need to be saved and restored
          while power domain switches state.

      power-supply: true

    required:
      - compatible
      - reg

additionalProperties: false

examples:
  - |
    #include <dt-bindings/clock/rk3399-cru.h>
    #include <dt-bindings/power/rk3399-power.h>

    soc {
        #address-cells = <2>;
        #size-cells = <2>;

        qos_iep: qos@ffa98000 {
            compatible = "syscon";
            reg = <0x0 0xffa98000 0x0 0x20>;
        };

        qos_rga_r: qos@ffab0000 {
            compatible = "syscon";
            reg = <0x0 0xffab0000 0x0 0x20>;
        };

        qos_rga_w: qos@ffab0080 {
            compatible = "syscon";
            reg = <0x0 0xffab0080 0x0 0x20>;
        };

        qos_video_m0: qos@ffab8000 {
            compatible = "syscon";
            reg = <0x0 0xffab8000 0x0 0x20>;
        };

        qos_video_m1_r: qos@ffac0000 {
            compatible = "syscon";
            reg = <0x0 0xffac0000 0x0 0x20>;
        };

        qos_video_m1_w: qos@ffac0080 {
            compatible = "syscon";
            reg = <0x0 0xffac0080 0x0 0x20>;
        };

        power-management@ff310000 {
            compatible = "rockchip,rk3399-pmu", "syscon", "simple-mfd";
            reg = <0x0 0xff310000 0x0 0x1000>;

            power-controller {
                compatible = "rockchip,rk3399-power-controller";
                #power-domain-cells = <1>;
                #address-cells = <1>;
                #size-cells = <0>;

                /* These power domains are grouped by VD_CENTER */
                pd_iep@RK3399_PD_IEP {
                    reg = <RK3399_PD_IEP>;
                    clocks = <&cru ACLK_IEP>,
                             <&cru HCLK_IEP>;
                    pm_qos = <&qos_iep>;
                };
                pd_rga@RK3399_PD_RGA {
                    reg = <RK3399_PD_RGA>;
                    clocks = <&cru ACLK_RGA>,
                             <&cru HCLK_RGA>;
                    pm_qos = <&qos_rga_r>,
                             <&qos_rga_w>;
                };
                pd_vcodec@RK3399_PD_VCODEC {
                    reg = <RK3399_PD_VCODEC>;
                    clocks = <&cru ACLK_VCODEC>,
                             <&cru HCLK_VCODEC>;
                    pm_qos = <&qos_video_m0>;
                };
                pd_vdu@RK3399_PD_VDU {
                    reg = <RK3399_PD_VDU>;
                    clocks = <&cru ACLK_VDU>,
                             <&cru HCLK_VDU>;
                    pm_qos = <&qos_video_m1_r>,
                             <&qos_video_m1_w>;
                };
            };
        };
    };
